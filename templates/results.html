<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kết quả tìm kiếm – "{{ query }}"</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="container">
    <h1>Kết quả tìm kiếm cho: "{{ query }}"</h1>

    <!-- Ô nhập tìm kiếm -->
    <div class="search-box">
        <form action="{{ url_for('search') }}" method="get">
            <input type="text" name="query" value="{{ query }}" placeholder="Nhập từ khóa...">
            <button type="submit">Tìm kiếm</button>
        </form>
    </div>

    {% if results is not none and not results.empty %}
    <div class="movie-grid">
        {% for movie in results.itertuples() %}
        <div class="movie-card">
            <!-- Ảnh poster -->
            <img src="{{ movie.poster or movie.poster_url or url_for('static', filename='img/no_poster.jpg') }}"
                 alt="{{ movie.title }}">

            <!-- Thông tin phim -->
            <div class="movie-info">
                <h3>{{ movie.title }}</h3>
                <p><b>Genre:</b> {{ movie.genre }}</p>
                <p class="similarity">Similarity: {{ "%.3f"|format(movie.similarity_score) }}</p>
                <p>{{ movie.plot[:150] }}...</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Thanh phân trang -->
    <div class="pagination">
        {% if page > 1 %}
        <a href="{{ url_for('search', query=query, page=page-1) }}">&laquo; Trước</a>
        {% endif %}

        {% set display_pages = [] %}
        {% for p in range(1, total_pages + 1) %}
            {% if p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
                {% do display_pages.append(p) %}
            {% endif %}
        {% endfor %}

        {% set last = 0 %}
        {% for p in display_pages %}
            {% if p - last > 1 %}
                <span class="dots">...</span>
            {% endif %}
            {% if p == page %}
                <strong>{{ p }}</strong>
            {% else %}
                <a href="{{ url_for('search', query=query, page=p) }}">{{ p }}</a>
            {% endif %}
            {% set last = p %}
        {% endfor %}


        {% if page < total_pages %}
        <a href="{{ url_for('search', query=query, page=page+1) }}">Sau &raquo;</a>
        {% endif %}
    </div>
    {% else %}
    <p>Không tìm thấy kết quả nào cho từ khóa "{{ query }}".</p>
    {% endif %}
</div>
</body>
</html>
